Name: Microsoft EntraID
Description: Auth provider for Microsoft Entra ID (Azure AD)
Metadata: envVars: OBOT_ENTRA_AUTH_PROVIDER_CLIENT_ID,OBOT_ENTRA_AUTH_PROVIDER_CLIENT_SECRET,OBOT_ENTRA_AUTH_PROVIDER_TENANT_ID,OBOT_AUTH_PROVIDER_COOKIE_SECRET,OBOT_AUTH_PROVIDER_EMAIL_DOMAINS
Metadata: noUserAuth: entra-auth-provider
Credential: ../placeholder-credential as entra-auth-provider

#!sys.daemon ${GPTSCRIPT_TOOL_DIR}/bin/gptscript-go-tool

---
!metadata:Microsoft EntraID:providerMeta
{
    "icon": "https://upload.wikimedia.org/wikipedia/commons/f/fa/Microsoft_Azure.svg",
    "iconDark": "https://upload.wikimedia.org/wikipedia/commons/f/fa/Microsoft_Azure.svg",
    "link": "https://entra.microsoft.com",
    "postgresTablePrefix": "entra_",
    "envVars": [
        {
            "name": "OBOT_ENTRA_AUTH_PROVIDER_CLIENT_ID",
            "friendlyName": "Client ID",
            "description": "The Application (client) ID from your Azure App Registration.",
            "sensitive": false
        },
        {
            "name": "OBOT_ENTRA_AUTH_PROVIDER_CLIENT_SECRET",
            "friendlyName": "Client Secret",
            "description": "The client secret value from Certificates & secrets in your Azure App Registration.",
            "sensitive": true
        },
        {
            "name": "OBOT_ENTRA_AUTH_PROVIDER_TENANT_ID",
            "friendlyName": "Tenant ID",
            "description": "The Directory (tenant) ID, or 'common'/'organizations' for multi-tenant apps.",
            "sensitive": false
        },
        {
            "name": "OBOT_AUTH_PROVIDER_COOKIE_SECRET",
            "friendlyName": "Cookie Secret",
            "description": "Secret used to encrypt cookies. Must be a base64-encoded string that decodes to at least 32 bytes (256 bits). Generate with: openssl rand -base64 32",
            "sensitive": true,
            "hidden": true
        },
        {
            "name": "OBOT_AUTH_PROVIDER_EMAIL_DOMAINS",
            "friendlyName": "Allowed E-Mail Domains",
            "description": "A comma-separated list of email domains allowed to authenticate. Use * to allow all domains.",
            "sensitive": false
        }
    ],
    "optionalEnvVars": [
        {
            "name": "OBOT_ENTRA_AUTH_PROVIDER_COOKIE_SECRET",
            "friendlyName": "Provider-Specific Cookie Secret",
            "description": "Provider-specific secret to encrypt cookies (overrides OBOT_AUTH_PROVIDER_COOKIE_SECRET). Must be a base64-encoded string that decodes to at least 32 bytes (256 bits). Generate with: openssl rand -base64 32",
            "sensitive": true,
            "hidden": true
        },
        {
            "name": "OBOT_AUTH_PROVIDER_POSTGRES_CONNECTION_DSN",
            "friendlyName": "PostgreSQL Connection String (DSN)",
            "description": "The connection string for PostgreSQL session storage. If unset, cookies will be used instead.",
            "sensitive": true,
            "hidden": true
        },
        {
            "name": "OBOT_AUTH_PROVIDER_TOKEN_REFRESH_DURATION",
            "friendlyName": "Token Refresh Duration",
            "description": "Time before refreshing auth tokens. Format: 1h1m1s. Default: 1h",
            "sensitive": false
        },
        {
            "name": "OBOT_ENTRA_AUTH_PROVIDER_ALLOWED_GROUPS",
            "friendlyName": "Allowed Azure AD Groups",
            "description": "Comma-separated list of Azure AD group IDs allowed to authenticate. Leave empty to allow all groups.",
            "sensitive": false
        },
        {
            "name": "OBOT_ENTRA_AUTH_PROVIDER_ALLOWED_TENANTS",
            "friendlyName": "Allowed Tenant IDs",
            "description": "Comma-separated list of tenant IDs allowed for multi-tenant apps. Required if Tenant ID is 'common' or 'organizations'.",
            "sensitive": false
        },
        {
            "name": "OBOT_ENTRA_AUTH_PROVIDER_USE_WORKLOAD_IDENTITY",
            "friendlyName": "Use Workload Identity",
            "description": "Enable Azure Workload Identity for Kubernetes (eliminates need for client secret). Set to 'true' to enable.",
            "sensitive": false
        },
        {
            "name": "OBOT_ENTRA_AUTH_PROVIDER_GROUP_CACHE_TTL",
            "friendlyName": "Group Cache TTL",
            "description": "How long to cache user group memberships. Format: 1h, 30m, etc. Default: 1h. Shorter values mean faster permission propagation but more API calls.",
            "sensitive": false
        },
        {
            "name": "OBOT_ENTRA_AUTH_PROVIDER_ICON_CACHE_TTL",
            "friendlyName": "Icon Cache TTL",
            "description": "How long to cache profile pictures. Format: 24h, 12h, etc. Default: 24h. Profile pictures rarely change, so longer values reduce API calls.",
            "sensitive": false
        },
        {
            "name": "OBOT_AUTH_INSECURE_COOKIES",
            "friendlyName": "Allow Insecure Cookies (Development Only)",
            "description": "Set to 'true' to allow HTTP cookies for local development. NEVER enable in production - exposes session tokens over unencrypted HTTP.",
            "sensitive": false,
            "hidden": true
        }
    ]
}
